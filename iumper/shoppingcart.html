<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>中柏商城-中柏平板电脑、中柏笔记本电脑、中柏电脑官方网站</title>
    <link rel="stylesheet" type="text/css" href="Public/css/style.css">
</head>
<body>
    <div class=main>
        <div>
            <ul class="pt1">
                <li>您所在的位置:</li>
               <li>
                   <a href="#">首页</a><span class="Pt1-ulspan">></span>
                </li>
                <li>
                    <a href="#" class="pt1-aa">购物车</a>
                </li>
            </ul>
        </div>
        <div  class="shopping-flow">
            <ul>
                <li class="shopping-flowgoing">
                    <h1>1</h1>
                    <p>我的购物车</p> 
                </li>
                <li class="shopping-arrows">
                  <h1>2</h1>  
                  <p>填写核对订单</p>    
                </li>
                <li class="shopping-noarrows">
                   <h1>3</h1> 
                   <p>提交订单</p>   
                </li>
            </ul>
        </div>
        <div class="shoppingcart-div">
            <table class="shoppingcart-table">
               <thead>
                   <tr>					
                        <th class="w-53"></th>
                        <th class="w-373">商品名称</th>
                        <th class="w-156">规格</th>
                        <th class="w-153">单价</th>
                        <th class="w-156">数量</th>
                        <th class="w-153">小计</th>
                        <th class="w-156">操作</th>
                   </tr>
               </thead> 
               <tbody>
                   <tr> 
                        <td>
                             <input type="checkbox">
                        </td>
                        <td>
                            <span>
                                <a href="#">
                                     <img src="Public/images/1554879131.jpg" alt=""> 
                                </a>
                            </span>
                            <span>
                                <a href="#">Jumper/中柏 EZpad 7 128G平板电脑二合一    win10平板电脑二合一</a>
                            </span>
                        </td>
                        <td>极光银色 128G</td>
                        <td>
                            <p>￥1250.00</p>
                            <p>
                               <s>￥1250.00</s> 
                            </p>
                        </td>
                        <td>
                            <div>
                                <img src="Public/images/jj1.png" >
                            </div>
                            <input type="text" value="1">
                            <div>
                                <img src="Public/images/jj0S.png" class="imgadd">
                            </div>
                        </td>
                        <td>￥1250.00</td>
                        <td> 
                            <a >删除</a>  
                            <span>/</span> 
                            <a >加入我的收藏</a>
                        </td>
                    </tr>    
                    <tr> 
                            <td>
                                 <input type="checkbox">
                            </td>
                            <td>
                                <span>
                                    <a href="#">
                                         <img src="Public/images/1554879131.jpg" alt=""> 
                                    </a>
                                </span>
                                <span>
                                    <a href="#">Jumper/中柏 EZpad 7 128G平板电脑二合一    win10平板电脑二合一</a>
                                </span>
                            </td>
                            <td>极光银色 128G</td>
                            <td>
                                <p>￥1500.00</p>
                                <p>
                                   <s>￥1500.00</s> 
                                </p>
                            </td>
                            <td>
                                <div>
                                    <img src="Public/images/jj1.png" >
                                </div>
                                <input type="text" value="1">
                                <div>
                                    <img src="Public/images/jj0S.png" class="imgadd">
                                </div>
                            </td>
                            <td>￥1500.00</td>
                            <td> 
                                <a >删除</a>  
                                <span>/</span> 
                                <a >加入我的收藏</a>
                            </td>
                        </tr>             
               </tbody>
               <tfoot>
                   <tr class="shoppingcart-tfoot">
                        <td>
                            <input type="checkbox">
                        </td>
                        <td class="text-left shoppingcart-tfootdeldct">
                            删除选中商品(需要加点击事件)
                        </td>
                        <td colspan="5" class="text-right">
                             <p class="shoppingcart-tfoot-total">已选 
                                 <span id="sum">0</span> 件商品，需付总金额（不含运费）： 
                                 <span id="total">0.00</span>
                            </p> 
                            <button class="shoppingcart-tfoot-button">去结算</button> 
                        </td>
                   </tr>
               </tfoot>
            </table>
        </div>
    </div>
    <script>
        (function(){
//输入数值为\d事件
       var table=document.querySelector(".shoppingcart-table")
       var bodytr=document.querySelectorAll(".shoppingcart-table>tbody>tr");
       var total=document.getElementById("total");
       var sum=document.getElementById("sum");       
       var cnball=document.querySelector(".shoppingcart-tfoot>td>input");
       var cnbs=document.querySelectorAll(".shoppingcart-table>tbody>tr>td>input:first-child");
/*点击全选事件*/
                  cnball.onclick=function(){
                     var i=0,m=0.00;
               for(var cnb of cnbs){
                 cnb.checked=cnball.checked;   /*全选状态*/
                 if(cnball.checked==true){
                  i+=cnb.checked
                  sum.innerHTML=i;              /*全选数量*/
                 var subtotal=cnb.parentNode.parentNode.children[5];/*当前小计*/
                  m+=parseFloat(subtotal.innerHTML.slice(1));
                  total.innerHTML="￥"+m.toFixed(2)/*全选价格*/
                  }else{total.innerHTML="0.00";sum.innerHTML="0";}
               }
             }
/*删除选中商品事件*/
        var selectDelede=cnball.parentNode.nextElementSibling;
        console.log(1)
        selectDelede.onclick=function(){
         if(confirm("确定要删除选中的记录吗？一旦删除将不能恢复！")){
                 var i=0
            for (var cnb of cnbs){
                if(cnb.checked==true){              
                     var tr=cnb.parentNode.parentNode;
                     table.deleteRow(tr.rowIndex); 
                     i++      
                    }
                }
                if(i===0){
                    alert("未选中任意商品")
                }else{
                    alert(`已删除${i}件商品`)
                    }   
            }  
        }       
/*body每行tr i*/             
       for(var i of bodytr){ 
        //onchange  
/*点击单选事件cnb*/
        var cnb=i.children[0].firstElementChild;
              cnb.onclick=function(){
               var cnb=this;
                 var subtotal=cnb.parentNode.parentNode.children[5];/*当前小计*/                
                 var subtotalHTML=parseFloat(subtotal.innerHTML.slice(1));                
                 var totalHTML=parseFloat(total.innerHTML.slice(1));/*当前总价*/
                  if(cnb.checked==false){
                     cnball.checked=false;
                     sum.innerHTML-- ;                           
                 var m=totalHTML-subtotalHTML;
                 total.innerHTML="￥"+m.toFixed(2)
                  }
                  else{
                     sum.innerHTML++;
                 var m=totalHTML+subtotalHTML;
                 total.innerHTML="￥"+m.toFixed(2);
                     /*获取没有被选中的数组*/     
                var uncnb=document.querySelector(".shoppingcart-table>tbody>tr>td:first-child>input:not(:checked)");
                     /*当找不到时，全选*/
                    if(uncnb===null){
                        cnball.checked=true;
                        }
                      }
                  }
/*单件数量框焦点失去事件*/
            var AdSutinput=i.children[4].children[1];
             AdSutinput.onblur=function(){
                 var AdSutinput=this
                 /*正则判断不能为非数字*/
                 if(AdSutinput.value.search(/^\d+$/i)==-1){
                    AdSutinput.value="1"}
                /*当前对应小计subtotal=当前对应单价price*当前数量*/ 
                   var price=AdSutinput.parentNode.previousElementSibling.firstElementChild
                   var a=parseInt(price.innerHTML.slice(1)*AdSutinput.value);
                       subtotal=AdSutinput.parentNode.nextElementSibling
                    /*以前对应小计*/    
                        var subtotaled=parseInt(subtotal.innerHTML.slice(1));
                /*赋值给当前的小计*/     
                        subtotal.innerHTML="￥"+(a).toFixed(2);
                /*如果当前商品已经被选中.总计发生改变*/
                         if(AdSutinput.parentNode.parentNode.firstElementChild.firstElementChild.checked==true){
                             totaling=parseInt(total.innerHTML.slice(1))
                             /*现在总计=以前总计+现在小计-以前总计*/
                            total.innerHTML="￥"+(totaling+a-subtotaled).toFixed(2)                            
                        }
                }
/*加减符号事件*/    
            var AddSubtract=i.children[4].querySelectorAll("img");
             function jiajian(code){
                var AddSubtract=this
                var adstd=AddSubtract.parentNode.parentNode
                var subtotal=adstd.nextElementSibling
                var price=adstd.previousElementSibling.firstElementChild
                var add=adstd.children[1];
                if(code===0&&add.value>1){
                    add.value--;
                }else if(code===1&&add.value<100){
                    add.value++;
                };
                    /*当前小计具体数字*/
                      a=parseInt(price.innerHTML.slice(1)*add.value);
                      /*以前小计具体数字*/
                      var subtotaled=parseInt(subtotal.innerHTML.slice(1));
                      subtotal.innerHTML="￥"+(a).toFixed(2);
                      if(this.parentNode.parentNode.parentNode.firstElementChild.firstElementChild.checked==true){
                        totaling=parseInt(total.innerHTML.slice(1))
                        /*现在总计=以前总计+现在小计-以前总计*/
                        total.innerHTML="￥"+(totaling+a-subtotaled).toFixed(2)                            
                       }
                 } 
  /*减*/          AddSubtract[0].onclick=function(){
                       var array=jiajian.call(this,0)
                }
   /*加*/       AddSubtract[1].onclick=function(){
                       var array=jiajian.call(this,1)
                } 
/*删除事件*/
                var delede=i.lastElementChild.firstElementChild;
                delede.onclick=function(){
                    if(confirm("确定要删除选中的记录吗？一旦删除将不能恢复！")){
                    var delede=this;
                    var tr=delede.parentNode.parentNode;
                    table.deleteRow(tr.rowIndex);
                    }
                }
/*收藏*/  
               var collect=i.lastElementChild.lastElementChild;  
               collect.onclick=function(){
                   alert("加入收藏成功")
                //alert("您已收藏过该商品") 
               }  
/*结算------------------------------------------------------------*/               
 }/*for*/
    })()
    </script>
</body>
</html>